---
title: "Group Exercise"
author: Group 7
date: Nov 18, 2023
output: 
    html_document:
        # latex_engine: xelatex
        toc: true
        toc_depth: 2
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
library(ggplot2)
library(FactoMineR)
library(factoextra)
library(FactoMineR)
library(Factoshiny)
library(httpgd)
library(reshape2)
```

# Data mining

```{r}
df <- read.csv(
  "decathlon.csv", 
  row.names=1, 
  sep=";"
)

# Prepare data

df$Competition <- as.factor(df$Competition)

# Normalize data

df.norm <- data.frame(scale(df[,1:10]), df[,11:13])

cor(df[, c(1:12)])

pairs(df[, c(1:12)])
```

# Apply PCA

```{r}
res.pca <- PCA(
  df.norm, 
  quanti.sup = c("Rang", "Points"), 
  quali.sup = "Competition",
  graph = F
)
```

# Eigenvalues

## Eigenevalues table

```{r}
  res.pca$eig[1:5, ]
```

## Eigenvalues plot

```{r}
  fviz_eig(res.pca)
```

First four components have a eigenvalue value of greater than 1.

However, the first two dimension comprising more than 50% of the total variability of the cloud of individuals (or variables) is represented by the plane, it is adequate to expresses a significant structure in the data.

# Individuals

## Plot

```{r}
plot.PCA(
  res.pca, 
  axes = c(1,2),
  choix = "ind", 
  invisible = c("quali", "var"),
  select = "cos2 0.4",
  unselect = 0.8
)
```

-   Observation:

Highly correlated to dim1 than dim2: MAYER, WIESIOLEK, LELIEVRE

Highly correlated to dim2 than dim1: Kaul, Suarez, Zhuk, GADO

$\Rightarrow$ Interpretation:

## By Points

```{r}
  plot.PCA(
    res.pca, 
    axes = c(1,2),
    choix = "ind", 
    habillage = "Points", 
    invisible = c("quali", "var"),
    select = "cos2 0.4",
    unselect = 0.8
  )
```

-   Observation:

Individuals positively correlated to dim 1 has the highest scores, and ones with negative correlation to dim 1 has lowest scores.

$\Rightarrow$ Interpretation:

## By Competition

```{r}
  plot.PCA(
    res.pca, 
    axes = c(1,2),
    choix = "ind", 
    habillage = "Competition", 
    invisible = c("quali", "var"),
    select = "cos2 0.4",
    unselect = 0.8
  )
```

# Variables

## Plot

```{r}
  plot(res.pca,
     axes = c(1, 2),
     choix="var",
     hab="none",
     invisible = c("quali", "ind"),
     select="cos2 0.4",
     unselect=0.8
  )

```

-   Observation:

$\Rightarrow$ Interpretation:

# Main axes of PCA

```{r}
  res.km <- kmeans(res.pca$var$coord, centers = 3, nstart=25)
  grp <- as.factor(res.km$cluster)
  plot.PCA(res.pca, choix="var", col.var=grp, select="cos2 0.3")
  # fviz_pca_var(res.pca, axes=c(3,4), repel=T, col.var=grp)
```

## 1st dimension

From the plot of correlation, we can see that most running subjects (**X100m**, **X400m** and **X110.haies**) contribute significantly to the first dimension of PCA. Those subjects have high cos2 (higher than 0.5) and strong negative correlation to this dimension. Another observation is that **Range** (quantitative supplementary variable) also have high cos2 and strong negative correlation to dimension 1, whereas **Points** (another quantitative supplementary variable) demonstrates nearly perfect positive correlation with the 1st dimension and cos2 is very close to 1.0 (0.97). We can interpret that, the less time an athelete requires to complete a run, the more likely they are to gain higher points. Furthermore, Longueur have high cos2 in the main axes and almost lies in the opposite side of running subjects, indicating that an atheletes who are good at running also good at Longeur.

Let demonstrate the above observation by plotting some individual plots

```{r}
  plot.PCA(res.pca, habillage ="X100m", select="cos2 0.4")
  plot.PCA(res.pca, habillage ="X110m.haies", select="cos2 0.4")
  plot.PCA(res.pca, habillage ="Longueur", select="cos2 0.4")
  plot.PCA(res.pca, habillage ="Points", select="cos2 0.4")
```

As can be seen from these plots, from left to right of dimension 1, the time needed by an athelete to complete **100m run** or **110m haies run** *decreases*. In **Longueur** plot, athelete in the right of dimension 1 exhibit better performance (higher distance) comparing to those on the left. The point gained by athelte on the right side of dimension 1 is higher than those on the left.

For example, MAYER, Clayer and Warner both have good achievement in 100m Running, 110m Haies Running and Longueur. They also gained high points and top range, as shown below (comparing to Schawarzl, Kaul that in the middle of the axes and NILSSON, BARAN who are in the left side).

```{r}
  df[
    c('MAYER', 'Clay', 'Warner', 'Schwarzl', 'Kaul', 'NILSSON', 'BARAN'), 
    c('X100m', 'X110m.haies', 'Longueur', 'Points', 'Rang')
  ]
```

To conclusion, the first dimension of PCA represent performance of atheletes on **running subjects** and **Longueur**. This dimension also represent the **point** and the **range** of an athelete.

## 2nd dimension

The dimension 2 of PCA, however, does not well represent any subject. Some subjects that have *relatively high* cos2 to this dimension are mainly throwing sports such as **Javelot** (cos2=0.34), **Disque** (cos2=0.22) and **Poids** (cos2=0.17). Some sports also contribute fairly much to this dimension are X100m (cos2=0.29) and Longueur (cos2=0.24). Those subjects also have **high cos2 with the first dimension**. Because of that, atheletes that have high performance on those subject are positioned not only on the top of dimension 2, but also on the right of dimension 1, as can be seen from the following individual plots:

```{r}
  plot.PCA(res.pca, habillage ="Javelot", select="cos2 0.4")
  plot.PCA(res.pca, habillage ="Disque", select="cos2 0.4")
  plot.PCA(res.pca, habillage ="Poids", select="cos2 0.4")
```

Let choose some individuals to see their performance:\

-   Kaul, Suarez, Zhuk: Top of dimension 2.
-   Sebrle, Clay, MAYER: Right of dimension 1.
-   WIESIOLEK: Left of dimension 1, In the middle of dimension 2.
-   Warners: In the middle of dimension 1, Bottom of dimension 2.

```{r}
  df[
    c("Kaul", "Suarez", "Zhuk", "Sebrle", "Clay", "MAYER", "WIESIOLEK", "Warners"), 
    c("Javelot", "Disque", "Poids", "Longueur", "Points", "Rang")]
```

As we can see, Kaul, Suarez and Zhuk have better performance in **Javelot** and **Disque** than WIESIOLEK and Warners, who are in lower positions in dimension 2 and low position in dimension 1. Warners, despite being at the low position of dimension 2, still have similar performance in Poids to Kaul, Suarez and Zhuk since he is further to the right in dimension 1 than those three. However, Kaul, Suarez and Zhuk are not as good in **Disque** and **Poids** as Sebrle, Clay and MAYER, who are in lower positions in dimension 2 but on the right side of dimension 1.

We can conclude that, dimension 2 can somehow represents athelete performance in **throwing sports** and **Longueur** as people in the top position in this dimension tend to achieve *above-average performance* in these sports.

## 3rd dimension

Using `dimdesc`, we can get 4 variables that are well represented on dimension 3,

```{r}
  dimdesc(res.pca)$`Dim.3`
```

which are: **X1500m**, **Disque**, **Perche** and **X400m**. The variable PCA plot below can also demonstrate it.

```{r}
  plot.PCA(
    res.pca, 
    choix="var", 
    axes=c(2,3), 
    invisible = "quanti.sup", 
    select="cos2 0.2"
  )
```

Let plot individual plot using those variable as habillage:

```{r}
  plot.PCA(res.pca, axes=c(2,3), habillage ="X1500m", select="cos2 0.4")
  plot.PCA(res.pca, axes=c(2,3), habillage ="Disque", select="cos2 0.4")
  plot.PCA(res.pca, axes=c(2,3), habillage ="Perche", select="cos2 0.4")
  plot.PCA(res.pca, axes=c(2,3), habillage ="X400m", select="cos2 0.4")
  
```

We can clearly see that athelete positioned at the top of dimension 3 have better performance on X1500m, X400m, Disque, Perche. We can validate this by considering 4 atheletes:\
- Duckworth, Ziemek: Top position of dimension 3 - Cairoli, Bourrada: Bottom position of dimension 3

```{r}
  df[
      c("Duckworth", "Ziemek", "Cairoli", "Bourrada"), 
      c("X1500m", "X400m", "Disque", "Perche")
  ]
```

As we can see, Duckworth and Ziemek outperform Cairoli and Bourrada on almost listed sports, except that Duckworth is worse than Bourrada in **Disque**. This is due to cos2 of **Disque** on dimension 2 and dimension 3 are similar (0.22 and 0.19) and athelete performance on this sport is positive correlated on both of 2 dimensions, which means athelete are on the right side of dimension 2 or on the top of dimension 3 tend to have higher performance on Disque. As we can see in individual plot, although Duckworth lies higher than Bourrada on dimension 3, he lies further to the left in dimension 2 than Bourrada. This can explain why Duckworth performance on Disque are not so different than that of Bourrada.

## **o	Những người chiến thắng mười môn phối hợp xuất sắc trong những môn nào? Tồn tại trường hợp môn thi nào ít có ảnh hưởng đến thành tích (số điểm) trong mười môn phối hợp không? (MAYER, Eaton, Sebrle, Mayer, Clay, Warner, Abele)**

```{r}
plot(res.pca,
     axes = c(1, 2),
     choix = c("var"),
     col.hab = "Points",
     invisible = c("ind"),
     select=NULL,
     unselect=0.8
     )
```

* Chúng ta thấy rằng trên đồ thị vòng tròn tương quan có biến bổ sung “Points” gần như thẳng hàng với dimension thứ nhất. Điều này có nghĩa là những người giành chiến thắng trong mười môn phối hợp đã thể hiện tốt trong các môn thể thao có tương quan cao với thành phần chính đầu tiên.

```{r}
res.pca$var$coord
```

* Ngoài ra, chúng ta thấy rằng các môn thể thao gắn liền với thành phần chính đầu tiên nhất (có giá trị coord gần 1 hoặc -1) gồm: Longueur, Disque, Poids, X100m, X400m, X110m.haies. Như vậy, những người chiến thắng mười môn phối hợp xuất sắc trong những môn có tương quan chặt chẽ với thành phần chính thứ nhất vừa được liệt kê.

* Tương tự, các môn thể thao ít có ảnh hưởng đến thành tích (số điểm) sẽ có tương quan thấp đối với trục thứ nhất, gồm: Perche và X1500.

## **o	So sánh thành tích đạt được ở 4 cuộc thi. Bạn có thể nói gì về thành tích trung bình trong cuộc thi này?**
```{r}
plot(res.pca,
     axes = c(1, 2),
     choix="ind",
     hab="Competition",
     invisible = c("var","quanti"),
     select=NULL,
     unselect=0.8
     )

plotellipses(res.pca, label="none")
```

Ở mức độ tin cậy 0.95, các hình elip độ tin cậy có sự phân ra về hai phía bên phải (JO04 và JO16) và bên trái (Decastar18 và CE18). Quan sát trên có thể chỉ ra rằng các cuộc thi mười môn phối hợp và hệ thống tính điểm có sự ưu tiên với một số môn thể thao có quan hệ chặt chẽ với thành phần chính thứ nhất, trong đó phần lớn vận động viên có sự thể hiện tốt hơn trong các kì thi JO04 và JO08. 

Ngoài ra, giữa JO04 và JO16, có các hình elip độ tin cậy trùng nhau, vì vậy chúng gần như giống hệt nhau, nhưng có khác biệt giữa hai cuộc thi này với Decastar18 và CE18.

Giữa Decastar18 và CE18 có sự trùng lấp không quá lớn, cho nên giữa hai kì thi vẫn có một phần khác biệt.

```{r}
plotellipses(res.pca, label="none", level = .5)
```

Ở mức độ tin cậy 0.50, các khoảng tin cậy của JO04 và JO18 vẫn chồng lấp, trong khi của Decastar18 và CE18 bị phân tách.
