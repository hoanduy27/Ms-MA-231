---
title: "Assignment"
author: Group 7
date: Nov 18, 2023
output: 
    html_document:
        # latex_engine: xelatex
        toc: true
        toc_depth: 2
---

```{r setup, include=FALSE} 

knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
library(ggplot2)
library(FactoMineR)
library(readxl)
library(httpgd)
```

```{r}
df <- read.csv("wine.data")
colnames(df) <- c(
    "class",
    "Alcohol",
    "Malic.acid",
    "Ash",
    "Alcalinity.of.ash",
    "Magnesium",
    "Total.phenols",
    "Flavanoids",
    "Nonflavanoid.phenols",
    "Proanthocyanins",
    "Color.intensity",
    "Hue",
    "OD280/OD315.of.diluted.wines",
    "Proline"
)

df$class <- as.factor(df$class)
```

# Quantity & Meaning

```{r}
variables <- colnames(df)
# Examine the elements, identify the measurement quantity and type of scale
for (variable in variables) {
  unique_values <- unique(df[[variable]])
  num_unique_values <- length(unique_values)
  
  ## Quantity and meaning
  if (is.numeric(df[[variable]])) {
    quantity <- "Measured Quantity"
    meaning <- "Numeric Value"
  } else if (is.character(df[[variable]])) {
    quantity <- "Measured Quantity"
    meaning <- "Categorical Value"
  } else {
    quantity <- "Unknown"
    meaning <- "Unknown"
  }
  
  ## Measurement quantity
  if (is.numeric(df[[variable]]) || is.integer(df[[variable]]) || is.double(df[[variable]])) {
    measurement_quantity <- "Numerical"
  } else if (is.character(df[[variable]]) || is.factor(df[[variable]])) {
    measurement_quantity <- "Categorical"
  } else {
    measurement_quantity <- "Unknown"
  }
  
  ## Scale type & Measurement type
  if (is.numeric(df[[variable]]) || is.integer(df[[variable]]) || is.double(df[[variable]])) {
    scale_type <- ifelse(num_unique_values > 10, "Continuous", "Discrete")
    measurement_type <- "Quantitative"
  } else if (is.character(df[[variable]]) || is.factor(df[[variable]])) {
    scale_type <- "Qualitative"
    measurement_type <- "Qualitative"
  } else {
    scale_type <- "Unknown"
    measurement_type <- "Unknown"
  }
  
  print(paste("Variable:", variable))
  print(paste("Quantity:", quantity))
  print(paste("Meaning:", meaning))
  print(paste("Number of Unique Values:", num_unique_values))
  print(paste("Measurement Quantity:", measurement_quantity))
  print(paste("Scale Type:", scale_type))
  print(paste("Measurement Type:", measurement_type))
  print("------------------------------")
}
```

# Hà

## PCA, CA

```{r, echo=FALSE, warning=FALSE}
# Packages
library(FactoMineR)
library(factoextra)
library(tidyverse)
library(corrplot)
library(dbplyr)
library(ggplot2)

# Import data
data <- read.csv("wine.data", 
                 header=FALSE, 
                 row.names=NULL)

# Setting up the data
colnames(data) <- c("Type","Alcohol", "Malic", "Ash", "Alcalinity", "Magnesium", "Phenols", "Flavanoids", "Nonflavanoids", "Proan", "Color", "Hue", "Dilution", "Proline")

data$Type <- as.factor(data$Type)

# Check for null values 
colSums(is.na(data))

# Research Hypotheses
# research_hypotheses <- c("Hypothesis 1: ...", "Hypothesis 2: ...")

# Statistical Hypotheses (example for t-test)
# Assuming 'variable1' and 'variable2' are the variables of interest
#statistical_hypotheses <- t.test(data$variable1, data$variable2)

# Multivariate Analysis Considerations
# Assuming 'data' is your dataset
correlation_matrix <- cor(data[-1])
corrplot(correlation_matrix)
# Calculate correlation matrix

# Principal Component Analysis (PCA)
res.pca <- PCA(data, scale.unit=T, quali.sup="Type", graph=F)

# Multiple Correspondence Analysis (MCA)
#mca_result <- MCA(data)

# Eigenvalues
res.pca$eig

# Contribution
dimdesc(res.pca)

# Cos2
library("corrplot")
corrplot(res.pca$var$cos2, is.corr=F)

# Individuals
plot(res.pca,
     choix = "ind",
     hab = "Type",
     invisible = c("var"),
     select = "cos2 0.6",
     unselect = 0.7)

# Variables
plot(res.pca,
     choix = c("var"),
     hab = "none",
     invisible = c("ind"),
     select = NULL,
     unselect = 0.7)

# Correspondence Analysis
res.ca <- CA(data, quali.sup="Type", graph=F)

plot(res.ca, 
     invisible="col",
     selectRow = "cos2 100",
     unselect = 1
     )

plot(res.ca, 
     invisible="row",
     selectCol = NULL,
     unselect = 1
     )

# Thử Multiple Factor Analysis (MFA)
gr1 = data[1]
gr2 = data.frame(data[7:10], data[13])
gr3 = data.frame(data[2], data[11])
gr4 = data.frame(data[12], data[14])
gr5 = data[6]
gr6 = data[3]
data.cat = data.frame(gr1, gr2, gr3, gr4, gr5, gr6)

res.mfa <- MFA(data.cat,
               group = c(1, 5, 2, 2, 1, 1),
               type = c("n", rep("c",5)),
               name.group = c("Group1", "Group2", "Group3", "Group4", "Group5","Group6"),
               num.group.sup = c(1),
               graph = F)
```

## Hypotheses

### **Hypothesis 1:** Flavanoids significantly differentiate between wine types.

Null Hypothesis (H0): There is no significant difference in Flavanoids among different wine types.

Alternative Hypothesis (H1): There is a significant difference in Flavanoids among different wine types.

   - Test: ANOVA comparing Flavanoids and Phenols among different wine types.
   
   - R Code:
   
```{r}
     # ANOVA for Flavanoids among wine types
     model <- lm(Flavanoids ~ as.factor(Type), data = data)
     anova(model)
     
```

#### Interpretation

* Interpretation 

The ANOVA test indicates a highly significant difference in Flavanoids among different wine types (p < 0.001). 

Conclusion: This suggests that Flavanoids significantly vary across the wine types.

* Visualization

```{r}

# Boxplot for Flavanoids
boxplot(Flavanoids ~ as.factor(Type), data = data, xlab = "Wine Type", ylab = "Flavanoids Content", main = "Flavanoids Content across Wine Types")

```

#### Additional test

* Post-hoc test for Flavanoids

```{r}
# Tukey's HSD for Flavanoids
flavanoids_model <- aov(Flavanoids ~ as.factor(Type), data = data)
TukeyHSD(flavanoids_model)
```

* Flavanoids Interpretation

The differences in Flavanoids content between all pairs of wine types (1-2, 1-3, 2-3) are statistically significant (p < 0.001). Each pair shows a significant difference in Flavanoids levels.

Flavanoids significantly vary across all three types of wines, indicating distinct levels for each wine type.



### **Hypothesis 2:** Alcohol content differs significantly across wine types.

Null Hypothesis (H0): There is no significant difference in Alcohol content between different wine types.

Alternative Hypothesis (H1): There is a significant difference in Alcohol content between different wine types.

   - Test: ANOVA for Alcohol content between different wine types.
   
   - R Code:
   
```{r}
     # ANOVA for Alcohol among wine types
     model <- lm(Alcohol ~ as.factor(Type), data = data)
     anova(model)
```

#### Interpretation

* Interpretation

ANOVA indicates a highly significant difference in Alcohol content among different wine types (p < 0.001). This implies that the Alcohol content varies significantly across the wine types.

* Visualtization

```{r}
# Boxplot for Alcohol
boxplot(Alcohol ~ as.factor(Type), data = data, xlab = "Wine Type", ylab = "Alcohol Content", main = "Alcohol Content across Wine Types")
```

#### Additional test

* Post-hoc test for Alcohol

```{r}
# Tukey's HSD for Alcohol
alcohol_model <- aov(Alcohol ~ as.factor(Type), data = data)
TukeyHSD(alcohol_model)

```

* Alcohol Interpretation

The differences in Alcohol content between pairs of wine types (1-2, 1-3, 2-3) are statistically significant (p < 0.001 for all pairs). Each pair exhibits a significant difference in Alcohol levels.

Alcohol content significantly varies among all three types of wines, indicating distinct Alcohol levels for each wine type.



### **Hypothesis 3:** Color intensity varies significantly based on wine types.

Null Hypothesis (H0): There is no significant variation in Color intensity among different wine types.

Alternative Hypothesis (H1): There is a significant variation in Color intensity among different wine types.

   - Test: ANOVA for Color intensity among different wine types.
   
   - R Code:
   
```{r}
     # ANOVA for Color intensity among wine types
     model <- lm(Color ~ as.factor(Type), data = data)
     anova(model)
```

#### Interpretation

* Interpretation

ANOVA reveals a highly significant difference in Color intensity among different wine types (p < 0.001). This signifies that Color intensity significantly differs across the wine types.

* Visualization

```{r}
# Boxplot for Proline content
boxplot(Proline ~ as.factor(Type), data = data, xlab = "Wine Type", ylab = "Proline Content", main = "Proline Content across Wine Types")
```

#### Additional test

* Post-hoc test for Color intensity

```{r}
# Tukey's HSD for Color intensity
color_model <- aov(Color ~ as.factor(Type), data = data)
TukeyHSD(color_model)

```

* Color intensity Interpretation

Statistically significant differences in Color intensity exist between all pairs of wine types (1-2, 1-3, 2-3) with p < 0.001. Each pair shows a significant difference in Color intensity.

Color intensity significantly differs among all three types of wines, highlighting distinct Color intensity levels for each wine type.



### **Hypothesis 4:** Proline content differs significantly across wine types.

Null Hypothesis (H0): There is no significant difference in Proline content between different wine types.

Alternative Hypothesis (H1): There is a significant difference in Proline content between different wine types.

   - Test: ANOVA for Proline content between different wine types.
   
   - R Code:

```{r}
     # ANOVA for Proline among wine types
     model <- lm(Proline ~ as.factor(Type), data = data)
     anova(model)
```

#### Interpretation

* Interpretation

ANOVA indicates a highly significant difference in Proline content among different wine types (p < 0.001). This suggests significant variation in Proline content across the wine types. 

* Visualization

```{r}
# Scatterplot for Ash
plot(Ash ~ as.factor(Type), data = data, xlab = "Wine Type", ylab = "Ash Content", main = "Ash Content across Wine Types")

```

#### Additional test

* Post-hoc test for Proline

```{r}
# Tukey's HSD for Proline
proline_model <- aov(Proline ~ as.factor(Type), data = data)
TukeyHSD(proline_model)

```

* Proline Interpretation

Proline content shows statistically significant differences between all pairs of wine types (1-2, 1-3, 2-3) with p < 0.05. Each pair exhibits a significant difference in Proline levels.

Proline content significantly varies among all three types of wines, suggesting distinct Proline levels for each wine type.



### **Hypothesis 5:** Ash and Alcalinity contribute significantly to wine type classification.

* Null Hypothesis (H0): There is no significant relationship between Ash/Alcalinity and wine types.

* Alternative Hypothesis (H1): There is a significant relationship between Ash/Alcalinity and wine types.

   - Test: Correlation tests or t-tests comparing Ash and Alcalinity across wine types.
   
   - R Code:
   
```{r}
     # Correlation or t-tests for Ash and Alcalinity among wine types

     cor.test(data$Ash, data$Alcalinity)

     # or

     oneway.test(data$Ash ~ as.factor(data$Type))
     
     oneway.test(data$Alcalinity ~ as.factor(data$Type))
```

#### Interpretation

* Interpretation

Pearson's correlation and ANOVA both reveal significant relationships between Ash, Alcalinity, and wine types (p < 0.001). There's a significant correlation between Ash and Alcalinity. Additionally, both variables significantly differ among wine types. 

* Visualization

```{r}
# Scatterplot for Alcalinity
plot(Alcalinity ~ as.factor(Type), data = data, xlab = "Wine Type", ylab = "Alcalinity Content", main = "Alcalinity Content across Wine Types")

```

#### Additional test

Pairwise t-tests for Ash and Alcalinity

```{r}
# Pairwise t-tests for Ash among wine types
pairwise.t.test(data$Ash, data$Type, p.adjust.method = "bonferroni")

# Pairwise t-tests for Alcalinity among wine types
pairwise.t.test(data$Alcalinity, data$Type, p.adjust.method = "bonferroni")

```

* Ash Interpretation

For Ash content, the differences between wine types (1-2, 1-3, 2-3) are all statistically significant (p < 0.001, except for 3-2, p = 0.00028). Most pairs exhibit a significant difference in Ash levels except for Type 3 vs. Type 2, which is marginally insignificant.

Ash content significantly differs among most pairs of wine types, indicating variations in Ash levels between wine types.

* Alcalinity Interpretation

Alcalinity content shows statistically significant differences between Type 1 vs. Type 2 and Type 1 vs. Type 3 (p < 0.001). However, between Type 2 and Type 3, the difference is not significant (p = 0.081).

Alcalinity content significantly differs between Type 1 vs. Type 2 and Type 1 vs. Type 3 but is not significantly different between Type 2 and Type 3.

### **Hypothesis 6:** The mean levels of proanthocyanins differ across the three types of wines.

* Null Hypothesis (H0): The mean levels of proanthocyanins are equal across the three types of wines.

* Alternative Hypothesis (H1): At least one of the mean levels of proanthocyanins differs significantly among the three types of wines.

   - Test: ANOVA for Proanthocyanins content among the three types of wines.
   
   - R Code:
   
```{r}

model2 <- aov(Proan ~ Type, data = data)
summary(model2)

```

#### Interpretation

* Interpretation

The ANOVA results indicate a significant difference in mean levels of Proanthocyanins among the three types of wines (Type: 1, 2, and 3) with an F-value of 30.27 and a p-value of 5.13e-12.

The 'Type' variable significantly influences the Proanthocyanins levels in wines.

* Visualization aid

```{r}
boxplot(Proan ~ Type, data = data, xlab = "Wine Types", ylab = "Proanthocyanins Levels", main = "Proanthocyanins Levels across Wine Types")

```

#### Additional test

* Post-hoc test for Proanthocyanins

```{r}
# Performing Tukey's HSD test after ANOVA
tukey_result2 <- TukeyHSD(model2)
tukey_result2
```

* Proanthocyanins Interpretation

Proanthocyanins content shows significant differences between all pairs of wine types (1-2, 1-3, 2-3) with low adjusted p-value (0.0068, 0.000, 0.0000022, respectively). The result reveal statistically significant differences in mean levels of proanthocyanins between all pairs of wine types.

All three pairwise comparisons reveal significant differences, suggesting that all types of wines significantly differ from each other in terms of proanthocyanins content.

### Conclusion

Based on the comprehensive chemical analysis encompassing Flavanoids, Alcohol content, Color intensity, Proline content, Ash, Alcalinity, and Proanthocyanins, it is evident that the three types of wines originating from different cultivars in the same Italian region possess distinctive chemical compositions.

These findings imply that the measured chemical components play crucial roles in classifying and distinguishing between the wine types. The significant variations in these components among the wine types highlight their unique characteristics and suggest that these attributes could serve as reliable markers for classifying these wines into their respective cultivars.

The additional tests confirm and further emphasize the significant differences in chemical components among the three types of wines. Flavanoids, Alcohol content, Color intensity, Proline content, Ash, and Alcalinity all exhibit distinctive levels among the wine types, contributing significantly to the classification and differentiation of the wines based on their chemical profiles.

In summary, the chemical analysis provides robust evidence supporting the classification of the three types of wines based on their distinct chemical profiles, contributing to a deeper understanding of the variations and unique characteristics exhibited by each wine type derived from different cultivars in the same Italian region.

#Uyen

##Descriptive Statistics
```{r}

# Define the Mode function
Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

# Variables to analyze
key_numeric_variables <- c(
  "Alcohol",
  "Malic.acid",
  "Ash",
  "Alcalinity.of.ash",
  "Magnesium",
  "Total.phenols",
  "Flavanoids",
  "Nonflavanoid.phenols",
  "Proanthocyanins",
  "Color.intensity",
  "Hue",
  "OD280/OD315.of.diluted.wines",
  "Proline"
)

# Descriptive statistics for key numeric variables
numeric_summary <- summary(df[, key_numeric_variables])

# Print the summary
print(numeric_summary)

# Calculate and print mean, median, mode, and standard deviation for each numeric variable
for (variable in key_numeric_variables) {
  mean_value <- mean(df[[variable]])
  median_value <- median(df[[variable]])
  mode_value <- Mode(df[[variable]])
  sd_value <- sd(df[[variable]])

  cat("Variable:", variable, "\n")
  cat("Mean:", mean_value, "\n")
  cat("Median:", median_value, "\n")
  cat("Mode:", mode_value, "\n")
  cat("Standard Deviation:", sd_value, "\n")
  cat("------------------------------\n")
}
```

# Duy

Comments: 
- Missing value: I would process the same as Quang's
- Outlier detection & removal: kinda similar to Quang's, but should wrap in `for loop`
- Plots: 

## Outlier detection & removal
```{r}
outliers = rep(FALSE, nrow(df))

for (col in colnames(df)){
  if (col != "class"){
    Q1 <- quantile(df[, col], 0.25)
    Q3 <- quantile(df[, col], 0.75)
    IQR <- Q3 - Q1

    # Identify outliers
    outliers <- (outliers | (
                        df[, col] < (Q1 - 1.5 * IQR) 
                        | df[, col] > (Q3 + 1.5 * IQR) 
                    ))

  }
}

print("Outliers:")
print(df[outliers, ])

df.clean <- df[!outliers, ]

```

## Plots 
-- Boxplot 
```{r}
for (col in colnames(df.clean)){
  if (col != 'class'){
    # boxplot(df.clean[, col], main=col)
    boxplot(df.clean[, col] ~ df.clean[, 'class'], xlab='class', ylab=col) 
  }
}
```

-- Histogram 
```{r}
for (col in colnames(df.clean)){
  if(col != 'class'){
    hist(df.clean[, col], xlab=col)
  }
  else{
    barplot(table(df.clean[, col]), xlab=col, ylab='frequency')
  }

    

}
```


-- Scatter plot (pair)
```{r}
  pairs(
    subset(df.clean, select=-class),
    col = hcl.colors(3, "Temps")[df.clean[, 'class']],
    cex=0.5,
  )
```


-- Clustering
```{r}
  feat = scale(subset(df.clean, select=-class ))
  var_clust <- hclust((dist(t(feat))), method='ward.D')
  plot(var_clust)
```

#Quang's Code
## Check for Missing values in data
```{r}
# Check for missing values
missing_values <- colSums(is.na(df))

# Print columns with missing values
print(missing_values[missing_values > 0])

# Handle missing values (replace with mean, median, or remove rows/columns)
for (column in names(df)) {
  if (sum(is.na(df[[column]])) > 0) {
    if (is.numeric(df[[column]])) {
      # Replace with mean
      df[[column]][is.na(df[[column]])] <- mean(df[[column]], na.rm = TRUE)
    } else {
      # Replace with mode
      mode_val <- names(sort(table(df[[column]]), decreasing = TRUE)[1])
      df[[column]][is.na(df[[column]])] <- mode_val
    }
  }
}

# Check if missing values are handled
print(colSums(is.na(df)))
```

## 2. Incorrect Entries (Outliers and Errors)
```{r}
# 2. Incorrect Entries (Outliers and Errors)
# Check for outliers using IQR method
Q1 <- quantile(df$column_name, 0.25)
Q3 <- quantile(df$column_name, 0.75)
IQR <- Q3 - Q1

# Identify outliers
outliers <- df$column_name < (Q1 - 1.5 * IQR) | df$column_name > (Q3 + 1.5 * IQR)

# Print outliers
print(df[outliers, ])

# Handle outliers (remove or replace with a threshold)
# Remove outliers
df <- df[!outliers, ]

# Replace outliers with a threshold
threshold_value <- 10  # Adjust the threshold as needed
df$column_name[outliers] <- threshold_value
```

## 3. Scale
```{r}
# 3. Scale
# Standardize the variables
df_standardized <- as.data.frame(scale(df))

# Normalize the variables
df_normalized <- as.data.frame(scale(df, center = FALSE))
```


#Create histograms, box plots, scatter plots (Quang's code)
```{r}
library(ggplot2)

# Histogram for a numeric variable (e.g., Alcohol)
ggplot(df, aes(x = Alcohol)) +
  geom_histogram(binwidth = 1, fill = "blue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of Alcohol Content", x = "Alcohol", y = "Frequency")

# Box plot for a numeric variable (e.g., Alcohol by class)
ggplot(df, aes(x = class, y = Alcohol, fill = class)) +
  geom_boxplot() +
  labs(title = "Box Plot of Alcohol Content by Class", x = "Class", y = "Alcohol Content")

# Scatter plot for two numeric variables (e.g., Alcohol vs. Color.intensity)
ggplot(df, aes(x = Alcohol, y = Color.intensity, color = class)) +
  geom_point() +
  labs(title = "Scatter Plot of Alcohol vs. Color Intensity", x = "Alcohol", y = "Color Intensity")
```



# 4. Conclusions
#Uyen: Relate statistical significance to the real-world problem.

- Flavanoids Differentiation (Hypothesis 1):

Winemakers can leverage this information to tailor the Flavanoid content in wines, influencing the taste, aroma, and overall sensory experience. Consumers, on the other hand, can use Flavanoid levels as a factor in selecting wines based on their preferred flavor profiles.

- Alcohol Content Variation (Hypothesis 2):
 Winemakers can adjust Alcohol content to create wines with specific characteristics, catering to different preferences and occasions. Consumers may use this information to make choices based on desired Alcohol levels in wines. 
 
- Color Intensity Variation (Hypothesis 3):

Winemakers can optimize Color intensity to create visually distinct wines. Consumers may consider color as a factor in wine selection, associating it with taste preferences or the overall appeal of the wine.

- Proline Content Differences (Hypothesis 4):

Proline is associated with taste and quality. Winemakers can use this information to craft wines with specific flavor profiles. Consumers looking for particular taste characteristics can consider Proline content in their wine choices.

- Ash and Alcalinity Influence (Hypothesis 5):

The significant relationships between Ash, Alcalinity, and wine types suggest that these components contribute to the classification of wines. Winemakers can use this information to adjust and optimize these elements to achieve desired characteristics in their wines.

- Proanthocyanins Role (Hypothesis 6):

The significant differences in Proanthocyanins content among wine types indicate that this component is a key factor in differentiating between the wines. Understanding the role of Proanthocyanins is valuable for winemakers aiming to create wines with specific taste profiles.

- Overall Conclusion: In essence, the statistical significance of these chemical components in wine types provides actionable insights for both winemakers and consumers. It enables winemakers to craft wines with specific characteristics and empowers consumers to make informed choices based on their preferences, whether related to flavor, visual appeal, or health considerations.

Propose practical recommendations for refining or improving the data table:
a. Check for Consistency

Verify the consistency of data across columns, especially categorical variables like 'class.' Ensure that categories are labeled consistently, and there are no discrepancies or typos.

b. Feature Engineering

Consider creating new features that might enhance your analysis. For example, you could create interaction terms or derive new variables based on domain knowledge.

c. Cross-Validation

If you're planning to build predictive models, consider implementing cross-validation techniques to assess the generalization performance of your models. This can help ensure the robustness of your findings.

d. Documentation

Document the steps taken for data cleaning and preprocessing. This includes handling missing values, dealing with outliers, and any other modifications made to the dataset. Clear documentation enhances reproducibility and transparency.

e. Regular Updates:

If your dataset is periodically updated, establish a process for regular data maintenance and updates to ensure the ongoing quality of your dataset.